---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { resources, getResourceBySlug, type ResourceData } from '../../data/resources';

export function getStaticPaths() {
  return resources.map((resource) => ({
    params: { resource: resource.slug },
    props: { resourceData: resource },
  }));
}

interface Props {
  resourceData: ResourceData;
}

const { resourceData } = Astro.props;

// Title truncated to 60 chars for optimal SEO
const fullTitle = `${resourceData.title} | Motorcycle Wreck Law`;
const title = fullTitle.length > 60 ? fullTitle.substring(0, 57) + '...' : fullTitle;
const description = resourceData.description;

const schemaMarkup = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": resourceData.title,
  "description": description,
  "url": `https://motorcyclewrecklaw.com/resources/${resourceData.slug}`,
  "publisher": {
    "@type": "Organization",
    "name": "Motorcycle Wreck Law"
  }
};

const breadcrumbs = [
  { name: "Home", url: "/" },
  { name: "Resources", url: "/resources" },
  { name: resourceData.title, url: `/resources/${resourceData.slug}` }
];

// Get related resources
const relatedResources = resources
  .filter(r => resourceData.relatedTopics.includes(r.slug))
  .slice(0, 3);

const categoryColors = {
  guide: { bg: "bg-blue-100", text: "text-blue-800" },
  checklist: { bg: "bg-green-100", text: "text-green-800" },
  legal: { bg: "bg-purple-100", text: "text-purple-800" },
  safety: { bg: "bg-orange-100", text: "text-orange-800" }
};
const categoryStyle = categoryColors[resourceData.category];
---

<BaseLayout 
  title={title} 
  description={description}
  schemaMarkup={schemaMarkup}
  breadcrumbs={breadcrumbs}
>
  <!-- Hero Section -->
  <section class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white py-12 md:py-20">
    <div class="container-wide">
      <div class="max-w-4xl">
        <div class="flex items-center gap-2 text-gray-400 mb-4">
          <a href="/" class="hover:text-white transition">Home</a>
          <span>/</span>
          <a href="/resources" class="hover:text-white transition">Resources</a>
          <span>/</span>
          <span class="text-white">{resourceData.title}</span>
        </div>
        
        <div class="flex items-center gap-4 mb-6">
          <span class="text-5xl">{resourceData.icon}</span>
          <span class={`${categoryStyle.bg} ${categoryStyle.text} px-3 py-1 rounded-full text-sm font-medium capitalize`}>
            {resourceData.category}
          </span>
        </div>
        
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-extrabold mb-6">
          {resourceData.title}
        </h1>
        
        <p class="text-xl text-gray-300 leading-relaxed">
          {resourceData.description}
        </p>
      </div>
    </div>
  </section>

  <!-- Key Takeaways -->
  <section class="py-8 bg-primary-50 border-b border-primary-100">
    <div class="container-wide">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-lg font-bold text-primary-800 mb-4">ðŸ“Œ Key Takeaways</h2>
        <ul class="space-y-2">
          {resourceData.keyTakeaways.map((takeaway) => (
            <li class="flex items-start gap-2">
              <svg class="w-5 h-5 text-primary-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <span class="text-gray-700">{takeaway}</span>
            </li>
          ))}
        </ul>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <section class="py-12 md:py-16">
    <div class="container-wide">
      <div class="grid lg:grid-cols-3 gap-12">
        <!-- Content -->
        <div class="lg:col-span-2">
          <article class="prose prose-lg max-w-none prose-headings:text-gray-900 prose-h2:text-2xl prose-h2:mt-8 prose-h2:mb-4 prose-h3:text-xl prose-h3:mt-6 prose-h3:mb-3 prose-p:text-gray-700 prose-li:text-gray-700 prose-strong:text-gray-900">
            <Fragment set:html={resourceData.content.replace(/\n/g, '<br/>').replace(/## /g, '</p><h2>').replace(/### /g, '</p><h3>').replace(/<br\/><br\/>/g, '</p><p>').replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')} />
          </article>
        </div>

        <!-- Sidebar -->
        <aside class="lg:col-span-1">
          <div class="sticky top-8 space-y-8">
            <!-- CTA Box -->
            <div class="bg-primary-600 text-white p-6 rounded-xl">
              <h3 class="text-xl font-bold mb-3">Need Legal Help?</h3>
              <p class="text-primary-100 mb-4">
                Get a free case evaluation from experienced motorcycle accident attorneys.
              </p>
              <a href="/free-consultation" class="block bg-white text-primary-600 font-bold px-4 py-3 rounded-lg text-center hover:bg-gray-100 transition">
                Free Consultation
              </a>
            </div>

            <!-- Related Resources -->
            {relatedResources.length > 0 && (
              <div class="bg-gray-50 p-6 rounded-xl">
                <h3 class="font-bold text-gray-900 mb-4">Related Resources</h3>
                <div class="space-y-3">
                  {relatedResources.map((related) => (
                    <a href={`/resources/${related.slug}`} class="block group">
                      <div class="flex items-start gap-3">
                        <span class="text-xl">{related.icon}</span>
                        <div>
                          <div class="font-medium text-gray-900 group-hover:text-primary-600 transition">{related.title}</div>
                          <div class="text-sm text-gray-500">{related.category}</div>
                        </div>
                      </div>
                    </a>
                  ))}
                </div>
              </div>
            )}

            <!-- Quick Links -->
            <div class="bg-gray-50 p-6 rounded-xl">
              <h3 class="font-bold text-gray-900 mb-4">Quick Links</h3>
              <ul class="space-y-2">
                <li>
                  <a href="/free-consultation" class="text-primary-600 hover:underline">â†’ Free Case Evaluation</a>
                </li>
                <li>
                  <a href="/case-types" class="text-primary-600 hover:underline">â†’ Case Types</a>
                </li>
                <li>
                  <a href="/resources" class="text-primary-600 hover:underline">â†’ All Resources</a>
                </li>
              </ul>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </section>

  <!-- Form CTA -->
  <section class="py-16 bg-gray-900 text-white">
    <div class="container-wide">
      <div class="max-w-2xl mx-auto">
        <h2 class="text-3xl font-bold mb-6 text-center">Get Professional Help With Your Case</h2>
        <p class="text-gray-300 text-center mb-8">
          Knowledge is important, but there's no substitute for experienced legal representation. Get your free case evaluation today.
        </p>
        
        <form action="https://services.leadconnectorhq.com/hooks/OsNgWuy8oZzLbp5BXbnD/webhook-trigger/mva-site-lead" method="POST" class="bg-white rounded-xl p-6 md:p-8">
          <input type="hidden" name="source" value={`motorcyclewrecklaw-resource-${resourceData.slug}`} />
          <div class="grid md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
              <input type="text" name="firstName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-gray-900" required />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
              <input type="text" name="lastName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-gray-900" required />
            </div>
          </div>
          <div class="grid md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
              <input type="tel" name="phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-gray-900" required />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <input type="email" name="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-gray-900" required />
            </div>
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Brief Description</label>
            <textarea name="description" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-gray-900 resize-none" placeholder="Tell us about your accident..."></textarea>
          </div>
          <button type="submit" class="w-full btn btn-cta text-lg py-4">
            Get My Free Evaluation
          </button>
        </form>
      </div>
    </div>
  </section>
</BaseLayout>
